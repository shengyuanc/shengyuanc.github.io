<!DOCTYPE html>
<html lang="zh-TW">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0, maximum-scale=1.0, user-scalable=no">
    <title>周邊結帳計算機</title>
    <script src="https://cdn.tailwindcss.com"></script>
    <link href="https://fonts.googleapis.com/css2?family=Noto+Sans+TC:wght@400;500;700&display=swap" rel="stylesheet">
    <!-- Lucide Icons -->
    <script src="https://unpkg.com/lucide@latest"></script>
    <style>
        body {
            font-family: 'Noto Sans TC', sans-serif;
            background-color: #fdf2f8; /* Pink-50 */
            /* 關鍵修正：防止整個頁面的橡皮筋效果 */
            overscroll-behavior: none; 
        }
        .tap-highlight-transparent {
            -webkit-tap-highlight-color: transparent;
        }
        /* Custom scrollbar hide for cleaner UI */
        .no-scrollbar::-webkit-scrollbar {
            display: none;
        }
        .no-scrollbar {
            -ms-overflow-style: none;
            scrollbar-width: none;
        }
        /* iOS 滑動優化 */
        .smooth-scroll {
            -webkit-overflow-scrolling: touch;
        }
        /* Modal Animation */
        .modal-enter {
            opacity: 0;
            transform: scale(0.95);
        }
        .modal-enter-active {
            opacity: 1;
            transform: scale(1);
            transition: opacity 200ms, transform 200ms;
        }
    </style>
</head>
<!-- 修改 Body：使用 100dvh 確保填滿手機視窗，overflow-hidden 禁止整體捲動 -->
<body class="h-[100dvh] w-full overflow-hidden flex flex-col tap-highlight-transparent text-gray-800 bg-fdf2f8">

    <!-- Header: 移除 sticky，改為 flex item，自然停留在頂部 -->
    <header class="flex-none bg-white shadow-sm p-4 z-30 flex justify-between items-center relative">
        <div>
            <h1 class="text-xl font-bold text-pink-600 flex items-center gap-2">
                <i data-lucide="calculator" class="w-6 h-6"></i>
                結帳計算機
            </h1>
        </div>
        <!-- Safety Reset in header -->
        <button onclick="openResetModal()" class="text-sm bg-gray-100 hover:bg-gray-200 text-gray-600 px-3 py-2 rounded-lg transition flex items-center gap-1">
            <i data-lucide="rotate-ccw" class="w-4 h-4"></i>
            重置
        </button>
    </header>

    <!-- Product List: 
         1. flex-1 讓它佔據剩餘空間 
         2. overflow-y-auto 讓只有這裡可以捲動
         3. 移除 pb-48，因為 Footer 不再是 fixed 覆蓋，而是接在下方
    -->
    <main class="flex-1 overflow-y-auto p-4 no-scrollbar smooth-scroll relative z-0">
        <div class="grid gap-3" id="product-list">
            <!-- Items will be injected here by JS -->
        </div>
    </main>

    <!-- Footer: 移除 fixed，改為 flex-none，讓它自然接在 Main 下方 -->
    <footer class="flex-none bg-white border-t border-gray-200 z-30 shadow-[0_-4px_6px_-1px_rgba(0,0,0,0.1)] relative">
        
        <!-- Bonus Notification Area -->
        <div id="bonus-alert" class="px-4 py-2 text-center text-sm font-bold transition-colors duration-300 min-h-[50px] flex flex-col justify-center">
            <!-- Content changes dynamically -->
        </div>

        <div class="p-4 pt-2 pb-6"> <!-- 增加一點底部 padding 避免 iPhone Home Bar 遮擋 -->
            <div class="flex justify-between items-end mb-2">
                <span class="text-gray-500 font-medium">總金額</span>
                <span class="text-3xl font-bold text-gray-900" id="total-price">$0</span>
            </div>
            
            <button onclick="showCheckoutModal()" class="w-full bg-pink-600 hover:bg-pink-700 active:bg-pink-800 text-white font-bold py-3 rounded-xl shadow-lg transition transform active:scale-95 flex justify-center items-center gap-2">
                <i data-lucide="clipboard-list" class="w-5 h-5"></i>
                確認清單 & 結帳
            </button>
        </div>
    </footer>

    <!-- Checkout Modal Overlay -->
    <div id="checkout-modal" class="fixed inset-0 bg-black bg-opacity-50 z-50 hidden flex items-center justify-center p-4 backdrop-blur-sm">
        <!-- Modal Content -->
        <div class="bg-white w-full max-w-md rounded-2xl shadow-2xl overflow-hidden flex flex-col max-h-[85vh]">
            <div class="bg-pink-50 p-4 border-b border-pink-100 flex justify-between items-center flex-none">
                <h2 class="text-lg font-bold text-gray-800 flex items-center gap-2">
                    <i data-lucide="shopping-bag" class="w-5 h-5 text-pink-600"></i>
                    結帳清單確認
                </h2>
                <button onclick="closeModal()" class="text-gray-400 hover:text-gray-600 p-1">
                    <i data-lucide="x" class="w-6 h-6"></i>
                </button>
            </div>
            
            <div class="p-4 overflow-y-auto flex-1 smooth-scroll">
                <!-- Order Items -->
                <div id="modal-items" class="space-y-3 mb-4">
                    <!-- JS Injected items -->
                </div>

                <!-- Divider -->
                <div class="border
